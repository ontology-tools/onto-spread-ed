import{d as W,r as g,l as D,c as r,a as i,e as s,F as k,g as U,p as A,q as $,J as b,Q as y,u as o,v,f as x,h as _,t as V,s as B,j as I,$ as J}from"./chunks/filter-CdAXK93b.js";import{C as q}from"./chunks/CollapsibleCard-Ddxji76n.js";import{a as f,p as E}from"./chunks/bootbox-D3SJ_Fwv.js";import{_ as F}from"./chunks/_plugin-vue_export-helper-DlAUqK2U.js";const M={class:"settings"},z=["disabled","onClick"],G=["disabled","onClick"],Q={class:"input-group input-group-sm mb-3"},H=["onUpdate:modelValue"],K={class:"input-group input-group-sm mb-3"},X=["onUpdate:modelValue"],Y={class:"input-group input-group-sm mb-3"},Z=["onUpdate:modelValue"],ee={class:"input-group input-group-sm mb-3"},se=["onUpdate:modelValue"],te={class:"input-group input-group-sm mb-3"},le=["onUpdate:modelValue"],ae=["onUpdate:modelValue"],oe=["disabled","onClick"],ne=["disabled","onClick"],ie={key:0,class:"fa fa-spin fa-spinner"},re={key:1,class:"fa fa-check"},ue={key:2,class:"fa fa-close"},de={key:3,class:"fa fa-file-import"},pe={class:"d-flex gap-2"},fe=["disabled"],ce=["disabled"],me=W({__name:"Settings",setup(be){const c=URLS.prefix,n=g(SETTINGS);let w=g(!1),h=g(null),C=g(null),u=g(null),m=D(()=>w.value||h.value!==null||C.value!==null||u.value==="busy"),d=g({reload:null}),T={};async function O(a){C.value=a.full_name;const e=n.value.startup_repositories.indexOf(a.full_name)>=0;(await(await fetch(`${c}/api/settings/repositories/${e?"remove":"add"}_startup`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({full_name:a.full_name})})).json()).success?n.value.startup_repositories=e?n.value.startup_repositories.filter(p=>p!==a.full_name):[...n.value.startup_repositories,a.full_name]:await f({title:"Unsetting as startup failed",message:"The current configuration probably does not allow setting startup repositories."}),C.value=null}async function R(a){h.value=a.full_name,(await(await fetch(`${c}/api/settings/repositories/unload`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({full_name:a.full_name})})).json()).success?n.value.repositories=n.value.repositories.filter(t=>t!==a):await f({title:"Unloading failed",message:"The repository was probably already unloaded. Try refreshing the page."}),h.value=null}async function N(){w.value=!0;let a=await(await fetch(`${c}/api/settings/repositories/possibilities`)).json();if(a.success){const e=a.repositories,t=await E({title:"Found possible external parents",message:"Chose one of your repositories to load.",inputType:"select",inputOptions:e.map(({short_name:l,full_name:p},S)=>({value:S,text:`${l} (${p})`})),buttons:{confirm:{label:"Load repository",className:"btn-success"},cancel:{label:"Cancel",className:"btn-warning"}}});if(t!==null){const l=await(await fetch(`${c}/api/settings/repositories/load`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e[t])})).json();l.success?n.value.repositories=[...n.value.repositories,l.repo]:await f({title:"Loading failed",message:l.error})}}else await f({title:"Unloading failed",message:"The repository was probably already unloaded. Try refreshing the page."});w.value=!1}async function L(a,e){u.value="busy";try{const t=await(await fetch(`${c}/api/repo/${e.short_name}/install_workflow/${a}`,{method:"POST",headers:{"Content-Type":"application/json"}})).json();t.success||await f({title:"Workflow installation failed",message:t.msg}),u.value="success"}catch{await f({title:"Workflow installation failed",message:"An error occurred while installing the workflow."}),u.value="error"}}async function P(){d.value.reload="loading";try{const a=await(await fetch(`${c}/api/settings/repositories/reload`,{method:"post"})).json();a.success?(n.value.repositories=a.repositories,d.value.reload="success"):(await f({title:"Reloading settings failed",message:a.error}),d.value.reload="error")}catch{await f({title:"Reloading settings failed",message:"An error occurred while reloading the settings."}),d.value.reload="error"}T.reload&&clearTimeout(T.reload),T.reload=setTimeout(()=>d.value.reload=null,2e3)}return(a,e)=>(i(),r("div",M,[e[21]||(e[21]=s("h1",null,"Settings",-1)),e[22]||(e[22]=s("h3",null,"Repositories",-1)),(i(!0),r(k,null,U(n.value.repositories,t=>(i(),A(q,null,{title:$(()=>[_(V(t.short_name)+" ("+V(t.full_name)+") ",1)]),buttons:$(()=>[s("button",{disabled:o(m)||!n.value.changing_startup_allowed,class:"btn btn-primary btn-sm",onClick:l=>O(t)},[n.value.startup_repositories.indexOf(t.full_name)>=0?(i(),r(k,{key:0},[e[1]||(e[1]=s("i",{class:"fa fa-square-check"},null,-1)),e[2]||(e[2]=_(" Loaded on startup "))],64)):(i(),r(k,{key:1},[e[3]||(e[3]=s("i",{class:"fa fa-square"},null,-1)),e[4]||(e[4]=_(" Not loaded on startup "))],64))],8,z),n.value.loading_new_allowed?(i(),r("button",{key:0,disabled:o(m),class:"btn btn-danger btn-sm btn-circle",onClick:l=>{l.stopPropagation(),R(t)}},[s("i",{class:v([o(h)===t.full_name?["fa-spinner","fa-spin"]:["fa-trash"],"fa"])},null,2)],8,G)):x("",!0)]),body:$(()=>[e[13]||(e[13]=s("h6",null,"Core settings",-1)),s("div",Q,[e[5]||(e[5]=s("span",{class:"input-group-text"},"ID Length",-1)),b(s("input",{"onUpdate:modelValue":l=>t.id_digits=l,class:"form-control",type:"number"},null,8,H),[[y,t.id_digits]])]),s("div",K,[e[6]||(e[6]=s("span",{class:"input-group-text"},"Main branch",-1)),b(s("input",{"onUpdate:modelValue":l=>t.main_branch=l,class:"form-control",type:"text"},null,8,X),[[y,t.main_branch]])]),e[14]||(e[14]=s("h6",null,"Release",-1)),s("div",Y,[e[7]||(e[7]=s("span",{class:"input-group-text"},"Released OWL file",-1)),b(s("input",{"onUpdate:modelValue":l=>t.release_file=l,class:"form-control",type:"text"},null,8,Z),[[y,t.release_file]])]),s("div",ee,[e[8]||(e[8]=s("span",{class:"input-group-text"},"Released script",-1)),b(s("input",{"onUpdate:modelValue":l=>t.release_script_path=l,class:"form-control",type:"text"},null,8,se),[[y,t.release_script_path]])]),e[15]||(e[15]=s("h6",null,"Subontologies",-1)),e[16]||(e[16]=s("p",{class:"text-body-secondary"}," To generate hierarchical spreadsheets ",-1)),(i(!0),r(k,null,U(t.subontologies,l=>(i(),r("div",te,[e[10]||(e[10]=s("span",{class:"input-group-text"},"Excel",-1)),b(s("input",{"onUpdate:modelValue":p=>l.excel_file=p,class:"form-control",type:"text"},null,8,le),[[y,l.excel_file]]),e[11]||(e[11]=s("span",{class:"input-group-text"},"Released",-1)),b(s("input",{"onUpdate:modelValue":p=>l.release_file=p,class:"form-control",type:"text"},null,8,ae),[[y,l.release_file]]),s("button",{disabled:o(m),class:"btn btn-danger",onClick:p=>t.subontology=t.subontologies.filter(S=>S!=l)},e[9]||(e[9]=[s("i",{class:"fa fa-trash"},null,-1)]),8,oe)]))),256)),e[17]||(e[17]=s("h6",null,"Workflows",-1)),e[18]||(e[18]=s("p",{class:"text-body-secondary"}," Install github workflows in this repository ",-1)),s("button",{class:v([{"btn-success":o(u)==="success","btn-danger":o(u)==="error"},"btn btn-primary btn-sm"]),disabled:o(m),onClick:l=>L("externals",t)},[o(u)==="busy"?(i(),r("i",ie)):x("",!0),o(u)==="success"?(i(),r("i",re)):x("",!0),o(u)==="error"?(i(),r("i",ue)):(i(),r("i",de)),e[12]||(e[12]=_(" Automatically build externals owl file "))],10,ne)]),_:2},1024))),256)),s("div",pe,[n.value.loading_new_allowed?(i(),r("button",{key:0,disabled:o(m),class:"mb-3 btn btn-sm btn-primary add-file",onClick:N},[s("i",{class:v([o(w)?["fa-spinner","fa-spin"]:["fa-add"],"fa"])},null,2),e[19]||(e[19]=_(" Load repository "))],8,fe)):x("",!0),s("button",{class:v([[{success:"btn-success",null:"btn-primary",error:"btn-danger"}[o(d).reload]],"mb-3 btn btn-sm btn-primary add-file"]),disabled:o(m)||o(d).reload==="loading",onClick:e[0]||(e[0]=t=>P())},[s("i",{class:v([{success:["fa-check"],error:["fa-cross"],loading:["fa-spinner","fa-spin"]}[o(d).reload]??["fa-refresh"],"fa"])},null,2),e[20]||(e[20]=_(" Reload settings "))],10,ce),B(a.$slots,"buttons",{},void 0,!0)])]))}}),ge=F(me,[["__scopeId","data-v-064e11eb"]]),j=I(ge);j.config.globalProperties.$filters=J;j.mount("#vue-app-settings");
//# sourceMappingURL=settings.js.map
